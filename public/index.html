<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Birchdale Weather Report</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }
    .container { background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); max-width: 900px; width: 100%; overflow: hidden; }
    .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; position: relative; }
    .header h1 { font-size: 32px; margin-bottom: 10px; }
    .header p { opacity: 0.9; font-size: 14px; }
    .live-indicator { display: inline-block; width: 8px; height: 8px; background: #28a745; border-radius: 50%; margin-right: 5px; animation: pulse 2s infinite; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    .current-weather { padding: 30px; text-align: center; }
    .temperature { font-size: 64px; font-weight: 700; color: #667eea; margin: 10px 0; line-height: 1; }
    .description { font-size: 22px; color: #555; margin-bottom: 8px; text-transform: capitalize; }
    .feels-like { color: #888; font-size: 15px; margin-bottom: 25px; }
    .wind-primary { background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); color: white; padding: 20px 30px; margin: 0 30px 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3); }
    .wind-primary h3 { font-size: 18px; margin-bottom: 15px; opacity: 0.9; text-transform: uppercase; letter-spacing: 1px; }
    .wind-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; }
    .wind-stat { text-align: center; }
    .wind-stat-label { font-size: 12px; opacity: 0.8; margin-bottom: 5px; }
    .wind-stat-value { font-size: 28px; font-weight: 700; }
    .details { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-top: 20px; padding: 0 30px; }
    .detail-item { background: #f8f9fa; padding: 15px; border-radius: 10px; border-left: 4px solid #667eea; text-align: center; }
    .detail-label { font-size: 11px; color: #666; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px; }
    .detail-value { font-size: 18px; font-weight: 600; color: #333; }
    .precip-section { background: #e8f5e9; border-left: 4px solid #4caf50; padding: 15px 20px; margin: 20px 30px; border-radius: 8px; }
    .precip-section.none { background: #f5f5f5; border-left-color: #999; }
    .precip-title { font-size: 13px; color: #666; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px; }
    .precip-value { font-size: 20px; font-weight: 600; color: #333; }
    
    /* 24-HOUR CHART SECTION */
    .chart-section { padding: 30px; border-top: 2px solid #eee; background: #f8f9fa; }
    .chart-title { font-size: 22px; color: #667eea; margin-bottom: 20px; font-weight: 600; text-align: center; }
    .chart-container { position: relative; height: 400px; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 15px; }
    .chart-legend { background: white; padding: 15px; border-radius: 8px; font-size: 12px; color: #666; }
    .chart-legend-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 8px; }
    .chart-legend-item { display: flex; align-items: center; gap: 8px; }
    .chart-legend-color { width: 16px; height: 16px; border-radius: 3px; }
    
    .forecast-section { padding: 30px; border-top: 2px solid #eee; }
    .forecast-title { font-size: 22px; color: #667eea; margin-bottom: 20px; font-weight: 600; text-align: center; }
    .hourly-forecast { display: flex; gap: 12px; overflow-x: auto; padding: 10px 0; }
    .hour-card { flex: 0 0 140px; background: #f8f9fa; padding: 15px; border-radius: 12px; text-align: center; border: 2px solid #e0e0e0; transition: all 0.3s; }
    .hour-card:hover { border-color: #667eea; transform: translateY(-3px); box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2); }
    .hour-time { font-size: 14px; font-weight: 600; color: #667eea; margin-bottom: 10px; }
    .hour-temp { font-size: 24px; font-weight: 700; color: #333; margin: 8px 0; }
    .hour-wind-section { background: #e3f2fd; padding: 10px; border-radius: 8px; margin: 10px 0; }
    .hour-wind-title { font-size: 10px; color: #1976d2; text-transform: uppercase; margin-bottom: 5px; font-weight: 600; }
    .hour-wind-value { font-size: 16px; font-weight: 600; color: #1976d2; margin: 3px 0; }
    .hour-wind-dir { font-size: 13px; color: #555; font-weight: 500; }
    .hour-precip { font-size: 12px; color: #4caf50; margin-top: 8px; font-weight: 500; }
    .hour-precip.none { color: #999; }
    .seven-day-section { padding: 30px; border-top: 2px solid #eee; background: #f8f9fa; }
    .seven-day-container { overflow-x: auto; white-space: nowrap; padding: 10px 0; }
    .seven-day-forecast { display: inline-flex; gap: 12px; }
    .day-card { background: white; border-radius: 12px; padding: 15px; min-width: 140px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border: 2px solid #e0e0e0; transition: all 0.3s; }
    .day-card:hover { border-color: #667eea; transform: translateY(-2px); box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2); }
    .day-date { font-weight: 600; color: #667eea; font-size: 14px; margin-bottom: 8px; }
    .day-icon { width: 50px; height: 50px; margin: 8px auto; }
    .day-temps { font-size: 18px; font-weight: 600; margin: 8px 0; }
    .day-high { color: #d35400; }
    .day-low { color: #2980b9; }
    .day-wind { font-size: 13px; color: #555; margin: 6px 0; }
    .day-precip { font-size: 12px; color: #27ae60; margin-top: 6px; font-weight: 500; }
    .day-description { font-size: 11px; color: #777; margin-top: 6px; white-space: normal; line-height: 1.3; }
    .footer { background: #f8f9fa; padding: 20px; text-align: center; color: #777; font-size: 12px; }
    .updated { margin: 10px 0; font-style: italic; }
    .refresh-btn { background: #667eea; color: white; border: none; padding: 12px 24px; border-radius: 5px; cursor: pointer; font-size: 14px; margin-top: 10px; transition: all 0.3s; font-weight: 600; }
    .refresh-btn:hover { background: #5568d3; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4); }
    .lake-link-btn { display: inline-block; margin-top: 15px; padding: 12px 28px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-decoration: none; border-radius: 8px; font-weight: 600; font-size: 14px; transition: all 0.3s; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3); }
    .lake-link-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4); }
    .loading { display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 40px; }
    .spinner { border: 4px solid #f3f3f3; border-top: 4px solid #667eea; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .error { background: #f8d7da; color: #721c24; padding: 20px; margin: 20px; border-radius: 8px; border-left: 4px solid #dc3545; }
    @media (max-width: 768px) {
      .temperature { font-size: 48px; }
      .wind-stats { grid-template-columns: 1fr; gap: 10px; }
      .details { grid-template-columns: repeat(2, 1fr); }
      .hour-card { flex: 0 0 120px; }
      .day-card { min-width: 130px; padding: 12px; }
      .chart-container { height: 350px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üå§Ô∏è Birchdale Weather</h1>
      <p><span class="live-indicator"></span>Live updates from the Kootenays</p>
    </div>
    
    <div id="weather-content" class="current-weather">
      <div class="loading">
        <div class="spinner"></div>
        <p style="color: #666; margin-top: 15px;">Loading current weather...</p>
      </div>
    </div>
    
    <!-- 24-HOUR CHART SECTION -->
    <div id="chart-section" class="chart-section" style="display: none;">
      <div class="chart-title">üìä 24-Hour Weather Forecast</div>
      <div class="chart-container">
        <canvas id="weatherChart"></canvas>
      </div>
      <div class="chart-legend">
        <div class="chart-legend-grid">
          <div class="chart-legend-item">
            <div class="chart-legend-color" style="background: #667eea;"></div>
            <span>Temperature (¬∞C)</span>
          </div>
          <div class="chart-legend-item">
            <div class="chart-legend-color" style="background: #a8d5e2;"></div>
            <span>Wind Speed (km/h)</span>
          </div>
          <div class="chart-legend-item">
            <div class="chart-legend-color" style="background: rgba(168, 213, 226, 0.3);"></div>
            <span>Wind Gust Area</span>
          </div>
          <div class="chart-legend-item">
            <div class="chart-legend-color" style="background: #548c2f;"></div>
            <span>Rain (mm)</span>
          </div>
          <div class="chart-legend-item">
            <div class="chart-legend-color" style="background: #ddd; border: 2px solid #a8d5e2;"></div>
            <span>Snow (mm)</span>
          </div>
          <div class="chart-legend-item">
            <div class="chart-legend-color" style="background: #104911;"></div>
            <span>Wind Direction ‚ñ≤</span>
          </div>
        </div>
      </div>
    </div>
    
    <div id="forecast-section" class="forecast-section" style="display: none;">
      <div class="forecast-title">üå¨Ô∏è Next 12 Hours - Wind Forecast</div>
      <div id="hourly-forecast" class="hourly-forecast"></div>
    </div>

    <div id="seven-day-section" class="seven-day-section" style="display: none;">
      <div class="forecast-title">üìÖ 7-Day Forecast</div>
      <div class="seven-day-container">
        <div id="seven-day-forecast" class="seven-day-forecast"></div>
      </div>
    </div>

    <div class="footer">
      <p><strong>Location:</strong> Birchdale (50.038¬∞N, 116.892¬∞W)</p>
      <p class="updated" id="update-time">Fetching data...</p>
      <button class="refresh-btn" onclick="loadWeather()">üîÑ Refresh Weather</button>
      <a href="lake.html" class="lake-link-btn">üåä View Kootenay Lake Levels</a>
      <p style="margin-top: 15px; font-size: 11px; opacity: 0.7;">Weather auto-refreshes every 10 minutes</p>
    </div>
  </div>

  <script>
    let weatherChart = null; // Store chart instance
    
    function getCardinalDirection(deg) {
      if (deg === null || deg === undefined) return "‚Äî";
      const dirs = ['N', 'NNE', 'NE', 'ENE', 'E', 'ESE', 'SE', 'SSE', 'S', 'SSW', 'SW', 'WSW', 'W', 'WNW', 'NW', 'NNW'];
      return dirs[Math.round(deg / 22.5) % 16];
    }
    
    function formatTime(timestamp) {
      const date = new Date(timestamp * 1000);
      return date.toLocaleString('en-US', {
        timeZone: 'America/Los_Angeles',
        month: 'long', day: 'numeric', year: 'numeric', hour: 'numeric', minute: '2-digit', hour12: true
      }) + ' PST';
    }
    
    function formatHourTime(timestamp) {
      const date = new Date(timestamp * 1000);
      return date.toLocaleString('en-US', { timeZone: 'America/Los_Angeles', hour: 'numeric', hour12: true });
    }
    
    function formatDayDate(timestamp) {
      const date = new Date(timestamp * 1000);
      return date.toLocaleString('en-US', { timeZone: 'America/Los_Angeles', weekday: 'short', month: 'short', day: 'numeric' });
    }
    
    function getPrecipType(hour) {
      if (hour.rain && hour.rain > 0) return 'Rain';
      if (hour.snow && hour.snow > 0) return 'Snow';
      return null;
    }
    
    function getPrecipAmount(hour) {
      const rain = hour.rain || 0;
      const snow = hour.snow || 0;
      return rain + snow;
    }
    
    function getDayPrecip(day) {
      const rain = day.rain || 0;
      const snow = day.snow || 0;
      return rain + snow;
    }
    
    // Custom arrow plugin for wind direction
    const windArrowPlugin = {
      id: 'windArrowPlugin',
      afterDatasetsDraw: function(chart) {
        const ctx = chart.ctx;
        const meta = chart.getDatasetMeta(5); // Wind direction dataset (index 5)
        
        if (!meta || !meta.data) return;
        
        meta.data.forEach((point, index) => {
          if (!point || point.skip) return;
          
          const x = point.x;
          const y = point.y;
          const windDir = chart.data.datasets[5].windDirections[index];
          
          // Convert wind direction to angle
          const angles = { 
            'N': 0, 'NNE': 22.5, 'NE': 45, 'ENE': 67.5, 
            'E': 90, 'ESE': 112.5, 'SE': 135, 'SSE': 157.5,
            'S': 180, 'SSW': 202.5, 'SW': 225, 'WSW': 247.5,
            'W': 270, 'WNW': 292.5, 'NW': 315, 'NNW': 337.5
          };
          const angle = angles[windDir] || 0;
          
          ctx.save();
          ctx.translate(x, y);
          ctx.rotate((angle * Math.PI) / 180);
          
          // Draw arrow shape (pointing up = North)
          ctx.fillStyle = '#104911';
          ctx.strokeStyle = '#104911';
          ctx.lineWidth = 1;
          
          ctx.beginPath();
          ctx.moveTo(0, -10);   // tip (pointing direction)
          ctx.lineTo(-5, 5);    // left base
          ctx.lineTo(0, 1);     // center notch
          ctx.lineTo(5, 5);     // right base
          ctx.closePath();
          ctx.fill();
          ctx.stroke();
          
          ctx.restore();
        });
      }
    };
    
    function create24HourChart(hourlyData) {
      const ctx = document.getElementById('weatherChart');
      if (!ctx) return;
      
      // Destroy existing chart if it exists
      if (weatherChart) {
        weatherChart.destroy();
      }
      
      // Prepare data arrays
      const labels = [];
      const temperatures = [];
      const windSpeeds = [];
      const windGusts = [];
      const windDirections = [];
      const rainPrecip = [];
      const snowPrecip = [];
      
      // Get 24 hours of data
      for (let i = 0; i < 24 && i < hourlyData.length; i++) {
        const hour = hourlyData[i];
        labels.push(formatHourTime(hour.dt));
        temperatures.push(hour.temp);
        windSpeeds.push(hour.wind_speed * 3.6); // m/s to km/h
        windGusts.push((hour.wind_gust || hour.wind_speed) * 3.6);
        windDirections.push(getCardinalDirection(hour.wind_deg));
        
        // Separate rain and snow
        const rain = hour.rain ? (hour.rain['1h'] || 0) : 0;
        const snow = hour.snow ? (hour.snow['1h'] || 0) : 0;
        rainPrecip.push(rain);
        snowPrecip.push(snow);
      }
      
      // Create chart
      weatherChart = new Chart(ctx.getContext('2d'), {
        type: 'line',
        data: {
          labels: labels,
          datasets: [
            // Temperature line
            {
              label: 'Temperature (¬∞C)',
              data: temperatures,
              borderColor: '#667eea',
              backgroundColor: 'transparent',
              borderWidth: 3,
              fill: false,
              yAxisID: 'y',
              tension: 0.4,
              pointRadius: 0,
              pointHoverRadius: 6,
              order: 2
            },
            // Wind speed line
            {
              label: 'Wind Speed (km/h)',
              data: windSpeeds,
              borderColor: '#a8d5e2',
              backgroundColor: 'rgba(168, 213, 226, 0.3)',
              borderWidth: 2,
              fill: '+1',
              yAxisID: 'y1',
              tension: 0.4,
              pointRadius: 0,
              pointHoverRadius: 5,
              order: 3
            },
            // Wind gusts line
            {
              label: 'Wind Gusts (km/h)',
              data: windGusts,
              borderColor: '#a8d5e2',
              backgroundColor: 'transparent',
              borderWidth: 2,
              borderDash: [5, 5],
              fill: false,
              yAxisID: 'y1',
              tension: 0.4,
              pointRadius: 0,
              pointHoverRadius: 4,
              order: 2
            },
            // Rain bars
            {
              label: 'Rain (mm)',
              data: rainPrecip,
              type: 'bar',
              backgroundColor: 'rgba(84, 140, 47, 0.6)',
              borderColor: 'rgba(84, 140, 47, 1)',
              borderWidth: 1,
              yAxisID: 'y1',
              barThickness: 10,
              order: 4
            },
            // Snow bars
            {
              label: 'Snow (mm)',
              data: snowPrecip,
              type: 'bar',
              backgroundColor: 'rgba(220, 220, 220, 0.8)',
              borderColor: '#a8d5e2',
              borderWidth: 2,
              yAxisID: 'y1',
              barThickness: 10,
              order: 4
            },
            // Wind direction markers (custom arrows)
            {
              label: 'Wind Direction',
              data: windSpeeds,
              windDirections: windDirections, // Store directions for plugin
              borderColor: 'transparent',
              backgroundColor: 'transparent',
              pointRadius: 0, // Hide default markers
              showLine: false,
              yAxisID: 'y1',
              order: 1
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          interaction: {
            mode: 'index',
            intersect: false,
          },
          plugins: {
            legend: {
              display: false
            },
            tooltip: {
              callbacks: {
                title: function(context) {
                  return `Time: ${context[0].label}`;
                },
                label: function(context) {
                  const datasetLabel = context.dataset.label;
                  const value = context.parsed.y.toFixed(1);
                  
                  if (datasetLabel === 'Wind Direction') {
                    const dir = windDirections[context.dataIndex];
                    return `Wind Direction: ${dir}`;
                  }
                  
                  return `${datasetLabel}: ${value}`;
                }
              },
              backgroundColor: 'rgba(0, 0, 0, 0.8)',
              padding: 12,
              titleFont: { size: 13, weight: 'bold' },
              bodyFont: { size: 12 }
            },
            annotation: {
              annotations: {
                highWindLine: {
                  type: 'line',
                  yMin: 12,
                  yMax: 12,
                  yScaleID: 'y1',
                  borderColor: '#ffd449',
                  borderWidth: 2,
                  borderDash: [8, 4],
                  label: {
                    display: true,
                    content: 'High Wind (12 km/h)',
                    position: 'end',
                    backgroundColor: '#ffd449',
                    color: '#104911',
                    font: {
                      size: 10,
                      weight: 'bold'
                    },
                    padding: 3
                  }
                }
              }
            }
          },
          scales: {
            x: {
              grid: {
                display: true,
                color: 'rgba(0, 0, 0, 0.05)'
              },
              ticks: {
                maxRotation: 45,
                minRotation: 45,
                font: {
                  size: 10
                }
              }
            },
            y: {
              type: 'linear',
              display: true,
              position: 'left',
              title: {
                display: true,
                text: 'Temperature (¬∞C)',
                color: '#667eea',
                font: {
                  size: 12,
                  weight: 'bold'
                }
              },
              grid: {
                color: 'rgba(102, 126, 234, 0.1)'
              },
              ticks: {
                color: '#667eea',
                font: {
                  weight: 'bold',
                  size: 11
                }
              }
            },
            y1: {
              type: 'linear',
              display: true,
              position: 'right',
              title: {
                display: true,
                text: 'Wind (km/h) / Precip (mm)',
                color: '#a8d5e2',
                font: {
                  size: 12,
                  weight: 'bold'
                }
              },
              grid: {
                drawOnChartArea: false,
              },
              ticks: {
                color: '#a8d5e2',
                font: {
                  weight: 'bold',
                  size: 11
                }
              }
            }
          }
        },
        plugins: [windArrowPlugin]
      });
    }
    
    async function loadWeather() {
      const content = document.getElementById('weather-content');
      const forecastSection = document.getElementById('forecast-section');
      const chartSection = document.getElementById('chart-section');
      const hourlyForecast = document.getElementById('hourly-forecast');
      const sevenDaySection = document.getElementById('seven-day-section');
      const sevenDayForecast = document.getElementById('seven-day-forecast');
      const updateTime = document.getElementById('update-time');
      
      content.innerHTML = '<div class="loading"><div class="spinner"></div><p style="color: #666; margin-top: 15px;">Loading current weather...</p></div>';
      forecastSection.style.display = 'none';
      chartSection.style.display = 'none';
      sevenDaySection.style.display = 'none';
      
      try {
        const response = await fetch('/.netlify/functions/weather');
        if (!response.ok) throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        
        const data = await response.json();
        const current = data.current;
        const today = data.daily[0];
        const hourly = data.hourly;
        const daily = data.daily;
        
        const temp = current.temp.toFixed(1);
        const feelsLike = current.feels_like.toFixed(1);
        const desc = current.weather[0].description;
        const humidity = current.humidity;
        const windSpeed = (current.wind_speed * 3.6).toFixed(1);
        const windGust = current.wind_gust ? (current.wind_gust * 3.6).toFixed(1) : windSpeed;
        const windDir = getCardinalDirection(current.wind_deg);
        const pressure = current.pressure;
        const high = today.temp.max.toFixed(0);
        const low = today.temp.min.toFixed(0);
        const uvIndex = current.uvi.toFixed(1);
        
        const currentRain = current.rain ? current.rain['1h'] || 0 : 0;
        const currentSnow = current.snow ? current.snow['1h'] || 0 : 0;
        const currentPrecip = currentRain + currentSnow;
        const precipType = currentSnow > 0 ? 'Snow' : (currentRain > 0 ? 'Rain' : 'None');
        
        content.innerHTML = `
          <div class="temperature">${temp}¬∞C</div>
          <div class="description">${desc}</div>
          <div class="feels-like">Feels like ${feelsLike}¬∞C</div>
          <div class="wind-primary">
            <h3>üí® Current Wind Conditions</h3>
            <div class="wind-stats">
              <div class="wind-stat"><div class="wind-stat-label">Wind Speed</div><div class="wind-stat-value">${windSpeed}</div><div class="wind-stat-label">km/h</div></div>
              <div class="wind-stat"><div class="wind-stat-label">Gusts</div><div class="wind-stat-value">${windGust}</div><div class="wind-stat-label">km/h</div></div>
              <div class="wind-stat"><div class="wind-stat-label">Direction</div><div class="wind-stat-value">${windDir}</div><div class="wind-stat-label">${current.wind_deg}¬∞</div></div>
            </div>
          </div>
          <div class="precip-section ${currentPrecip === 0 ? 'none' : ''}">
            <div class="precip-title">üíß Current Precipitation</div>
            <div class="precip-value">${currentPrecip > 0 ? `${currentPrecip.toFixed(1)} mm/hr (${precipType})` : 'No precipitation'}</div>
          </div>
          <div class="details">
            <div class="detail-item"><div class="detail-label">High / Low</div><div class="detail-value">${high}¬∞ / ${low}¬∞</div></div>
            <div class="detail-item"><div class="detail-label">Humidity</div><div class="detail-value">${humidity}%</div></div>
            <div class="detail-item"><div class="detail-label">Pressure</div><div class="detail-value">${pressure} hPa</div></div>
            <div class="detail-item"><div class="detail-label">UV Index</div><div class="detail-value">${uvIndex}</div></div>
            <div class="detail-item"><div class="detail-label">Visibility</div><div class="detail-value">${(current.visibility / 1000).toFixed(1)} km</div></div>
            <div class="detail-item"><div class="detail-label">Cloud Cover</div><div class="detail-value">${current.clouds}%</div></div>
          </div>
        `;
        
        // Create 24-hour chart
        create24HourChart(hourly);
        chartSection.style.display = 'block';
        
        hourlyForecast.innerHTML = '';
        for (let i = 0; i < 12 && i < hourly.length; i++) {
          const hour = hourly[i];
          const hourTemp = hour.temp.toFixed(0);
          const hourWind = (hour.wind_speed * 3.6).toFixed(1);
          const hourGust = hour.wind_gust ? (hour.wind_gust * 3.6).toFixed(1) : hourWind;
          const hourDir = getCardinalDirection(hour.wind_deg);
          const hourTime = formatHourTime(hour.dt);
          const hourPrecipAmount = getPrecipAmount(hour);
          const hourPrecipType = getPrecipType(hour);
          const precipDisplay = hourPrecipAmount > 0 ? `${hourPrecipAmount.toFixed(1)} mm ${hourPrecipType}` : 'No precip';
          const precipClass = hourPrecipAmount > 0 ? '' : 'none';
          
          hourlyForecast.innerHTML += `
            <div class="hour-card">
              <div class="hour-time">${hourTime}</div>
              <div class="hour-temp">${hourTemp}¬∞C</div>
              <div class="hour-wind-section">
                <div class="hour-wind-title">üå¨Ô∏è Wind</div>
                <div class="hour-wind-value">${hourWind} km/h</div>
                <div class="hour-wind-title">Gusts</div>
                <div class="hour-wind-value">${hourGust} km/h</div>
                <div class="hour-wind-dir">${hourDir}</div>
              </div>
              <div class="hour-precip ${precipClass}">${precipDisplay}</div>
            </div>
          `;
        }
        
        sevenDayForecast.innerHTML = '';
        for (let i = 1; i < 8 && i < daily.length; i++) {
          const day = daily[i];
          const dayDate = formatDayDate(day.dt);
          const dayHigh = day.temp.max.toFixed(0);
          const dayLow = day.temp.min.toFixed(0);
          const dayWind = (day.wind_speed * 3.6).toFixed(0);
          const dayDir = getCardinalDirection(day.wind_deg);
          const dayIcon = day.weather[0].icon;
          const dayDesc = day.weather[0].description;
          const dayPrecip = getDayPrecip(day);
          
          sevenDayForecast.innerHTML += `
            <div class="day-card">
              <div class="day-date">${dayDate}</div>
              <img src="https://openweathermap.org/img/wn/${dayIcon}@2x.png" class="day-icon" alt="${dayDesc}">
              <div class="day-temps"><span class="day-high">${dayHigh}¬∞</span> / <span class="day-low">${dayLow}¬∞</span></div>
              <div class="day-wind">${dayWind} km/h ${dayDir}</div>
              ${dayPrecip > 0 ? `<div class="day-precip">Precip: ${dayPrecip.toFixed(1)} mm</div>` : ''}
              <div class="day-description">${dayDesc}</div>
            </div>
          `;
        }
        
        forecastSection.style.display = 'block';
        sevenDaySection.style.display = 'block';
        updateTime.textContent = `Last updated: ${formatTime(current.dt)}`;
        
      } catch (error) {
        console.error('Error loading weather:', error);
        content.innerHTML = `<div class="error"><strong>‚ö†Ô∏è Error Loading Weather</strong><p style="margin-top: 10px;">${error.message}</p></div>`;
        updateTime.textContent = 'Failed to load weather data';
      }
    }
    
    window.addEventListener('DOMContentLoaded', loadWeather);
    setInterval(loadWeather, 10 * 60 * 1000);
  </script>
</body>
</html>
