name: ONE-TIME FIX - Reset PNG in Git

# Run this workflow ONCE to fix the PNG tracking issue
# After running this once, go back to using your normal daily_weather.yml

on:
  workflow_dispatch:  # Manual trigger only

permissions:
  contents: write

jobs:
  fix-png:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Fix PNG Git index
        run: |
          # Configure Git first
          git config --local user.name "Weather & Lake Bot"
          git config --local user.email "weather-bot@github-actions"
          
          echo "========================================="
          echo "FIXING PNG GIT INDEX"
          echo "========================================="
          echo ""
          
          echo "Current Git index for PNG:"
          git ls-files --stage public/lake_chart.png
          echo ""
          
          echo "Step 1: Remove PNG from Git index completely"
          git rm --cached public/lake_chart.png
          git commit -m "Remove PNG from Git index [skip ci]"
          echo "✓ PNG removed from index"
          echo ""
          
          echo "Step 2: Delete the physical PNG file"
          rm public/lake_chart.png
          git add public/lake_chart.png
          git commit -m "Delete PNG file [skip ci]"
          echo "✓ PNG file deleted"
          echo ""
          
          echo "Step 3: Push changes"
          git push
          echo "✓ Changes pushed"
          echo ""
          
          echo "========================================="
          echo "✓ FIX COMPLETE!"
          echo "========================================="
          echo ""
          echo "Next steps:"
          echo "1. Let your daily workflow run (it will recreate the PNG)"
          echo "2. The PNG should now commit properly each time"
          echo "3. Delete this one-time-fix workflow file"
